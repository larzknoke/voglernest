$(document).ready( function() {
// $( document ).on('turbolinks:load', function() {

    var vWidth        = $(window).width();
    var nav           = $('.stick-top')
    var navHeight     = nav.outerHeight();
    var headerHeight  = $('#head').outerHeight();
    var openAt        = $('.open-at');
    var noticeHofladen= $('.notice-hofladen');
    var contentCont   = $('.content-container');
    var logoFade      = $('.logo-fade');
    var boxWrapper    = $('.box-wrapper')[0];

    function isMobile() {
       if(vWidth <= 992) {
         return true;
       } else {
         return false;
       }
    }

    if (isMobile()) {
      $('body').addClass('mobile');
    }

    setTimeout(function() { 
      if ((typeof boxWrapper != 'undefined') && boxWrapper.scrollHeight > boxWrapper.clientHeight) {
        $('.info-box').addClass('overflown');
      }
    }, 500);

    $('.agree').click(function(){
      $('.cookie-notice').slideToggle(300,function(){$(this).remove()});
      Cookies.set('cookieAccept', true, { expires: 7 });
    });

    if (Cookies.get('cookieAccept')) {
      $('.cookie-notice').remove();
    }

    $(".eu-button").click(function(e) {
        e.preventDefault();
        $([document.documentElement, document.body]).animate({
            scrollTop: $("#eu").offset().top -50
        }, 1000);
    });


    $(window).scroll(function(){
        if( $(window).scrollTop() > headerHeight ) {
            nav.css({position: 'fixed', top: '0px'});
            openAt.attr("style", "display: none !important");
            contentCont.css( "padding-top",  navHeight );
            nav.addClass('box-shadow')
            logoFade.attr("style", "opacity: 1");
        } else {
            nav.css({position: 'relative', top: '220px'});
            if (isMobile()) {
              openAt.attr("style", "display: none !important")
            } else {
              openAt.attr("style", "display: block !important");
            }
            contentCont.css( "padding-top", 0 );
            nav.removeClass('box-shadow')
            logoFade.attr("style", "opacity: 0");
        }
    });

    $(window).scroll();

    $('#carousel').slick({
        infinite: true,
        slidesToShow: 1,
        slidesToScroll: 1,
        dots: false,
        arrows: true,
        autoplay: true,
        autoplaySpeed: 4000,
        adaptiveHeight: true,
        prevArrow: '<button type="button" class="slick-prev"></button>',
        nextArrow: '<button type="button" class="slick-next"></button>'
    });

    $('#carousel2').slick({
        prevArrow: '<button type="button" class="slick-prev"></button>',
        nextArrow: '<button type="button" class="slick-next"></button>'
    });


    $('.img-holder').mouseenter(function(){
      $('.img-item').removeClass('hover');
    }).mouseleave(function(){
      // $( ".img-item" ).first().addClass( "hover" );
    });



    $('.fw-gallery-item').click( function(event){

      var index = $( ".fw-gallery-item" ).index( this );

      $.magnificPopup.open({
        items: [
          {src: '<%= image_path("home/fewo/fewo1.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo2.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo4.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo5.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo6.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo7.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo8.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo9.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo10.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo11.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo12.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo13.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo14.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo15.jpg") %>'},
          {src: '<%= image_path("home/fewo/fewo16.jpg") %>'}
        ],
        type: 'image',
        // mainClass: 'mfp-zoom-in',
        gallery:{
          enabled: true
        },
        image: {
          verticalFit: true
        },
        removalDelay: 300, //delay removal by X to allow out-animation
        callbacks: {
          beforeOpen: function() {
            // just a hack that adds mfp-anim class to markup
             this.st.image.markup = this.st.image.markup.replace('mfp-figure', 'mfp-figure mfp-with-anim');
             this.st.mainClass = 'mfp-zoom-in';
          }
        },
      },index)

    });

    $('.hof-gallery-item').click( function(event){

      var index = $( ".hof-gallery-item" ).index( this );

      $.magnificPopup.open({
        items: [
          {src: '<%= image_path("home/slider/hof.jpg") %>'},
          {src: '<%= image_path("home/hof/gallery/hof1.jpg") %>'},
          {src: '<%= image_path("home/hof/gallery/hof2.jpg") %>'},
          {src: '<%= image_path("home/hof/gallery/hof3.jpg") %>'},
          {src: '<%= image_path("home/hof/gallery/hof4.jpg") %>'},
          {src: '<%= image_path("home/hof/gallery/hof5.jpg") %>'},
          {src: '<%= image_path("home/hof/gallery/hof6.jpg") %>'},
          {src: '<%= image_path("home/hof/gallery/hof7.jpg") %>'},
          // {src: '<%= image_path("home/hof/gallery/hof8.jpg") %>'}, // zu viel jonas ;)
          {src: '<%= image_path("home/hof/gallery/hof9.jpg") %>'},
          {src: '<%= image_path("home/hof/gallery/hof10.jpg") %>'},
          {src: '<%= image_path("home/hof/gallery/hof11.jpg") %>'},
          {src: '<%= image_path("home/hof/gallery/hof12.jpg") %>'},
          {src: '<%= image_path("home/hof/gallery/hof13.jpg") %>'}
        ],
        type: 'image',
        // mainClass: 'mfp-zoom-in',
        gallery:{
          enabled: true
        },
        image: {
          verticalFit: true
        },
        removalDelay: 300, //delay removal by X to allow out-animation
        callbacks: {
          beforeOpen: function() {
            // just a hack that adds mfp-anim class to markup
             this.st.image.markup = this.st.image.markup.replace('mfp-figure', 'mfp-figure mfp-with-anim');
             this.st.mainClass = 'mfp-zoom-in';
          }
        },
      },index)

    });

    $('.hofladen-gallery-item').click( function(event){

      var index = $( ".hofladen-gallery-item" ).index( this );

      $.magnificPopup.open({
        items: [
          {src: '<%= image_path("home/hofladen/hofladen1.jpg") %>'},
          {src: '<%= image_path("home/hofladen/hofladen2.jpg") %>'},
          {src: '<%= image_path("home/hofladen/hofladen3.jpg") %>'},
          {src: '<%= image_path("home/hofladen/hofladen4.jpg") %>'},
          {src: '<%= image_path("home/hofladen/hofladen5.jpg") %>'},
          {src: '<%= image_path("home/hofladen/hofladen6.jpg") %>'},
          {src: '<%= image_path("home/hofladen/hofladen7.jpg") %>'},
          {src: '<%= image_path("home/hofladen/hofladen8.jpg") %>'},
          {src: '<%= image_path("home/hofladen/hofladen9.jpg") %>'}
        ],
        type: 'image',
        // mainClass: 'mfp-zoom-in',
        gallery:{
          enabled: true
        },
        image: {
          verticalFit: true
        },
        removalDelay: 300, //delay removal by X to allow out-animation
        callbacks: {
          beforeOpen: function() {
            // just a hack that adds mfp-anim class to markup
             this.st.image.markup = this.st.image.markup.replace('mfp-figure', 'mfp-figure mfp-with-anim');
             this.st.mainClass = 'mfp-zoom-in';
          }
        },
      },index)

    });


    $('.biogas-gallery-item').click( function(event){

      var index = $( ".biogas-gallery-item" ).index( this );

      $.magnificPopup.open({
        items: [
          {src: '<%= image_path("home/slider/biogas2.jpg") %>'},
          {src: '<%= image_path("home/slider/biogas.jpg") %>'},
          {src: '<%= image_path("home/biogas/bio.jpg") %>'},
          {src: '<%= image_path("home/biogas/bio2.jpg") %>'},
          {src: '<%= image_path("home/biogas/bio3.jpg") %>'},
          {src: '<%= image_path("home/biogas/bio4.jpg") %>'}
        ],
        type: 'image',
        // mainClass: 'mfp-zoom-in',
        gallery:{
          enabled: true
        },
        image: {
          verticalFit: true
        },
        removalDelay: 300, //delay removal by X to allow out-animation
        callbacks: {
          beforeOpen: function() {
            // just a hack that adds mfp-anim class to markup
             this.st.image.markup = this.st.image.markup.replace('mfp-figure', 'mfp-figure mfp-with-anim');
             this.st.mainClass = 'mfp-zoom-in';
          }
        },
      },index)

    });


    $('.box-item .image-hover, .all-img-link').on('click', function () {
        $(this).closest('.box-item').magnificPopup('open');
    });
    $('.box-item').each(function () {
        $(this).magnificPopup({
            delegate: 'img',
            type: 'image',
            gallery: {
                enabled: true
            },
            callbacks: {
              elementParse: function(item) { item.src = item.el.attr('src'); }
            }
        });
    });

    $('#expand-news').on('click', function () {
        $(this).closest('.first-section').toggleClass('expanded-news');
        $(this).toggleClass('open');
        if ($(this).hasClass('open')){
          $('#carousel').slick('slickPause');
          $(this).html('<i class="fa fa-angle-double-right"></i> Übersicht schliessen');
        } else {
          $('#carousel').slick('slickPlay');  
          $(this).html('<i class="fa fa-angle-double-right"></i> Übersicht');
        }  
    });


  }); // document.ready
