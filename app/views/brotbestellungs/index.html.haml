%h1 Brotbestellungen

%table.ui.table
  %thead
    %tr
      %th #
      %th Vorname
      %th Name
      %th Telefon
      %th Email
      %th Datum
      %th Bestellschein
      %th
      %th
      %th

  %tbody
    - @brotbestellungs.each do |brotbestellung|
      %tr
        %td= brotbestellung.id
        %td= brotbestellung.vorname
        %td= brotbestellung.name
        %td= brotbestellung.telefon
        %td= brotbestellung.email
        %td= l(brotbestellung.datum, format: '%a, %d.%m.%Y')
        %td
          - if brotbestellung.brotbestellschein.present?
            = link_to brotbestellung.brotbestellschein.id, brotbestellung.brotbestellschein
          - else
            = '-'
        %td= link_to 'Zeigen', brotbestellung
        %td= link_to 'Bearbeiten', edit_brotbestellung_path(brotbestellung)
        %td= link_to 'LÃ¶schen', brotbestellung, method: :delete, data: { confirm: 'Sind Sie sicher?' }

%p
  = link_to 'Neue Brotbestellung', new_brotbestellung_path, :class => 'button ui green basic'


%h1 Brotbestellung nach Datum
- @brotbestellungs.order(:datum).group_by(&:datum).each do |datum, brotbestellungs|
  %h3{:style => 'display: inline-block;margin-right: 10px'}
    = l(datum, format: '%A, %d.%m.%Y')
  = link_to 'Offene Bestellungen auf Brotbestellschein', brotbestellscheins_path(:datum => datum), method: :post

  %table.ui.table
    %thead
      %tr
        %th Brotsorte
        %th Menge
    %tbody
      - brotbestellungs.collect(&:brotbestellposi).flatten.group_by(&:brotsorte).each do |sorte, posi|
        %tr
          %td= sorte.name
          %td= posi.collect(&:menge).sum
